/**
 * method kxui
 * version 1.3.2
 * author Lkx
 * create time 2018.05.31
 * update time 2018.11.26
 * website http://www.kxui.org
 */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function i(t,i,e,o){o="boolean"==typeof o?o:"boolean"==typeof e&&e,e="object"===("undefined"==typeof e?"undefined":_typeof(e))?e:"object"===("undefined"==typeof i?"undefined":_typeof(i))&&i;var s={0:"字段 {agg} 不符合结构规范"};o?console.error("kxui-"+e.version+"： "+s[t]+"。"):console.warn("kxui-"+e.version+"： "+s[t]+"。")}var e=t.kxui,o="undefined"!=typeof module&&"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports),s=function(t){this.parameter="object"===("undefined"==typeof t?"undefined":_typeof(t))?t:{},this.size="object"===_typeof(this.parameter.size)?this.parameter.size:{},this.carousel="object"===_typeof(this.parameter.carousel)?this.parameter.carousel:{},this.init()};s.prototype={init:function(){e.carousel||e.use("carousel",function(){},!1),this.variable()},variable:function(){this.sizeWidth=Number(this.size.width)||"",this.sizeHeight=Number(this.size.height)||"",this.imgWidth=this.sizeWidth?this.sizeWidth:(document.documentElement.clientWidth||document.body.clientWidth)-("mobile"===e.info().device?0:120),this.imgHeight=this.sizeHeight?this.sizeHeight:(document.documentElement.clientHeight||document.body.clientHeight)-("mobile"===e.info().device?0:120),this.id=Math.ceil(10*Math.random()),this.agg=this.parameter.agg,this.closeTime=null,this.index=this.carousel.index,this.arrow=this.carousel.arrow,this.indicator=this.carousel.indicator,this.time=this.carousel.time,this.autoplay="boolean"==typeof this.carousel.autoplay&&this.carousel.autoplay,this.anim=this.carousel.anim,this.callback=this.carousel.callback,this.agg&&this.agg.length>=0?this.skeleton():i(0,this.kxui,!0)},skeleton:function(){e.method.addClass(e.method.getDom("html",!0),"kxui-picture-html"),e.method.addClass(e.method.getDom("body",!0),"kxui-picture-body"),this.mask=e.method.addDom('<div class="kxui-picture"></div>'),this.carousel=e.method.addDom('<div id="kxui-picture-'+this.id+'" class="kxui-carousel"></div>'),this.box=e.method.addDom('<div class="kxui-carousel-box"></div>');for(var t=0;t<this.agg.length;t++){this.item=e.method.addDom('<div class="kxui-carousel-item"></div>'),this.img=e.method.addDom('<img src="'+this.agg[t]+'">');var i=this.cropImage(this.img);this.img.src=i,this.item.appendChild(this.img),this.box.appendChild(this.item)}this.carousel.appendChild(this.box),this.mask.appendChild(this.carousel),e.method.getDom("body",!0).appendChild(this.mask),this.dynamicStyle()},dynamicStyle:function(){this.carousel.style.width=this.imgWidth+"px",this.carousel.style.height=this.imgHeight+"px",this.carousel.style.marginTop=this.mask.offsetHeight/2-this.carousel.offsetHeight/2+"px",this.useCarousel()},useCarousel:function(){var t=this;e.carousel.binding({el:"#kxui-picture-"+t.id,index:t.index,arrow:t.arrow,indicator:t.indicator,time:t.time,autoplay:t.autoplay,anim:t.anim,callback:t.callback}),t.showAnimation(),t.event()},showAnimation:function(){this.mask.style.opacity="1"},event:function(){var t=this;t.mask.onclick=function(){return t.mask.style.opacity="0",clearTimeout(t.closeTime),t.closeTime=setTimeout(function(){e.method.getDom(".kxui-picture-body").removeChild(t.mask),e.method.delClass(e.method.getDom("html",!0),"kxui-picture-html"),e.method.delClass(e.method.getDom("body",!0),"kxui-picture-body")},300),!1}},cropImage:function(t){var i=t.naturalWidth,e=t.naturalHeight,o=i/e,s=this.imgWidth,a=this.imgHeight,h=0,n=this.imgHeight/2-s/o/2,d=document.createElement("canvas"),c=d.getContext("2d");return d.width=s,d.height=a,c.drawImage(t,h,n,s,s/o),d.toDataURL("image/jpeg",.9)}};var a=function(){this.name="Picture",this.info="Image magnification scheme"};a.fn=a.prototype,a.fn.enlarge=function(t){this.logic=new s(t),delete this.logic},e.picture=new a,o&&(e.picture=module.exports=new a)}(window);